# Template file for 'fractal'
pkgname=fractal
version=9
revision=1
build_style=meson
build_helper="rust"
hostmakedepends="cargo clang desktop-file-utils gettext glib-devel
 gtk-update-icon-cache pkg-config"
makedepends="gst-plugins-base1-devel gtksourceview5-devel libadwaita-devel
 libshumate-devel pipewire-devel rust-std libwebp-devel libseccomp-devel"
short_desc="Matrix Messaging Client for GNOME"
maintainer="Cameron Nemo <cam@nohom.org>"
license="GPL-3.0-or-later"
homepage="https://wiki.gnome.org/Apps/Fractal"
distfiles="https://gitlab.gnome.org/World/fractal/-/archive/${version}/fractal-${version}.tar.gz"
checksum=61be5f378545fe4ef76feb7d5604aac6261a3dedcfb5dd756713eacc574d5373

if [ "$XBPS_TARGET_WORDSIZE" = 32 ]; then
	broken="limited by Rust + crate dependencies"
fi

post_patch() {
	vsed -i "/xdg-desktop-portal/d" meson.build

	if [ "$CROSS_BUILD" ]; then
		vsed -i src/meson.build \
			-e "s%rust_target /%'${RUST_TARGET}' / &%"
	fi
}
